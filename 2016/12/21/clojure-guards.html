<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="/blog2-ssr/images/favicon-compressed.webp">
    <link rel="shortcut icon" href="/blog2-ssr/images/favicon-compressed.webp">
    <link rel="apple-touch-icon" href="/blog2-ssr/images/favicon-compressed.webp">

    <link rel="stylesheet" href="/blog2-ssr/shared.css">
    <link rel="stylesheet" href="/blog2-ssr/prism.css">

    <title>Clojure guards</title></head>
<body class="svelte-1gr3n62"><style>:root{--left-side:200px;--right-side:200px;--nav-height:64px;--background-color:#FFD166;--primary-color:#06D6A0;--primary-accent-color:#049F76;--secondary-color:#118AB2;--sub-color:#073B4C;--nav-background:#fff;--article-background:#fff
    }body.svelte-1gr3n62.svelte-1gr3n62{padding:0;margin:0;color:var(--sub-color);background:var(--background-color);font-family:Roboto, "Helvetica Neue", Arial, sans-serif;font-size:18px;display:grid;grid-template:var(--nav-height) auto var(--nav-height)/var(--left-side) calc(100% - var(--left-side) - var(--right-side)) var(--right-side)
    }nav.top.svelte-1gr3n62 .links.svelte-1gr3n62{grid-area:1/2/2/3;display:flex;align-items:center
    }nav.top.svelte-1gr3n62 .links a.svelte-1gr3n62{margin-right:1em
    }a.svelte-1gr3n62.svelte-1gr3n62{color:var(--secondary-color);text-decoration:none
    }a.svelte-1gr3n62.svelte-1gr3n62:hover,a.svelte-1gr3n62.svelte-1gr3n62:active{color:var(--sub-color)
    }footer.svelte-1gr3n62.svelte-1gr3n62{grid-area:3/1/4/4;background:#fff;display:inline-grid;grid-template:100%/var(--left-side) auto var(--right-side)
    }nav.top.svelte-1gr3n62.svelte-1gr3n62{background-color:var(--nav-background);display:inline-grid;grid-template:100%/var(--left-side) auto var(--right-side);grid-area:1/1/2/4
    }main.svelte-1gr3n62.svelte-1gr3n62{grid-area:2/2/3/3;margin-top:1em;display:flex;flex-direction:column
    }@media screen and (max-width: 1340px){:root{--left-side:0px;--right-side:0px
        }body.svelte-1gr3n62.svelte-1gr3n62{background:var(--background-color)
        }nav.top.svelte-1gr3n62 .links.svelte-1gr3n62{justify-content:space-around
        }}
.btn.svelte-7idbpu{display:inline-flex;font-size:18px;color:#fff;background:var(--primary-color);padding:10px;border-radius:8px
    }.btn.svelte-7idbpu:hover{background:var(--primary-accent-color);color:#fff
    }</style>

    <nav class="top svelte-1gr3n62">
            <div class="links svelte-1gr3n62"><a class="nav-link nav-item svelte-1gr3n62" href="/blog2-ssr/">Home</a>
                <a class="nav-link nav-item svelte-1gr3n62" href="/blog2-ssr/about/">About</a></div>
        </nav>

    <main class="svelte-1gr3n62"><article><h1>Clojure guards</h1>

    <time>21 Dec 2016 at 12:54</time>

    <div class="content"><p>Once I wanted to have something like a pretty “match” operator from Scala, but in Clojure.
And hence there are no default options for it in Clojure out of the box, here are some
alternatives I’ve found in the Internet.</p>
<!--more-->

<h2 id="using-guard-macro">Using <code>guard</code> macro</h2>
<pre><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> generateGuardBody
    <span class="token string">"Generates the function body required to support the guard macro"</span>
    <span class="token punctuation">[</span>args<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>thisBranch remainingBranches<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">split-at</span> <span class="token number">2</span> args<span class="token punctuation">)</span>
            testCond <span class="token punctuation">(</span><span class="token keyword">first</span> thisBranch<span class="token punctuation">)</span>
            testResult <span class="token punctuation">(</span><span class="token keyword">second</span> thisBranch<span class="token punctuation">)</span>
            elseFunc <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty?</span> remainingBranches<span class="token punctuation">)</span>
                <span class="token boolean">false</span>
                <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">=</span>  <span class="token number">1</span> <span class="token punctuation">(</span><span class="token keyword">count</span> remainingBranches<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">(</span><span class="token keyword">first</span> remainingBranches<span class="token punctuation">)</span>
                    <span class="token punctuation">(</span><span class="token function">generateGuardBody</span> remainingBranches<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token operator">`</span><span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token operator">~</span>testCond
            <span class="token operator">~</span>testResult
            <span class="token operator">~</span>elseFunc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defmacro</span> defguardfn
    <span class="token string">"Creates a haskell-style guarded function"</span>
    <span class="token punctuation">[</span>fnName args &amp; body<span class="token punctuation">]</span>
    <span class="token operator">`</span><span class="token punctuation">(</span><span class="token keyword">defn</span> <span class="token operator">~</span>fnName <span class="token operator">~</span>args
        <span class="token operator">~</span><span class="token punctuation">(</span><span class="token function">generateGuardBody</span> body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defmacro</span> guard
    <span class="token string">"Allows inline guard syntax without surrounding defn"</span>
    <span class="token punctuation">[</span>&amp; body<span class="token punctuation">]</span>
    <span class="token operator">`</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token function">generateGuardBody</span> body<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token punctuation">(</span><span class="token function">defguardfn</span> testFn <span class="token punctuation">[</span>n<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">=</span> <span class="token number">1</span> n<span class="token punctuation">)</span> <span class="token string">"You entered 1!"</span>
    <span class="token punctuation">(</span><span class="token keyword">=</span> <span class="token number">2</span> n<span class="token punctuation">)</span> <span class="token string">"You entered two!"</span>
    <span class="token punctuation">(</span><span class="token keyword">=</span> <span class="token number">3</span> n<span class="token punctuation">)</span> <span class="token string">"You entered three!"</span>
    <span class="token punctuation">(</span><span class="token keyword">></span> n <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"You entered a big number!"</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token punctuation">(</span><span class="token function">testFn</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token function">defguardfn</span> fib <span class="token punctuation">[</span>n<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">&lt;</span> n <span class="token number">2</span><span class="token punctuation">)</span> n
    <span class="token punctuation">(</span><span class="token keyword">+</span> <span class="token punctuation">(</span><span class="token function">fib</span> <span class="token punctuation">(</span><span class="token keyword">-</span> n <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">fib</span> <span class="token punctuation">(</span><span class="token keyword">-</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token punctuation">(</span><span class="token keyword">defn</span> testFn-<span class="token number">2</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">guard</span>
        <span class="token punctuation">(</span><span class="token keyword">=</span> x <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"One!"</span>
        <span class="token punctuation">(</span><span class="token keyword">=</span> x <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"Two!"</span>
        <span class="token boolean">true</span>  <span class="token string">"Something Else!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token punctuation">(</span><span class="token keyword">map</span> fib <span class="token punctuation">(</span><span class="token keyword">range</span> <span class="token number">0</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token punctuation">(</span><span class="token function">testFn-</span><span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; "Something else!"</span>
</code></pre>
<h2 id="using-multimethods">Using multimethods</h2>
<pre><code class="language-clojure"><span class="token comment">;; Implementing factorial using multimethods Note that factorial-like function</span>
<span class="token comment">;; is best implemented using `recur` which enables tail-call optimization to avoid</span>
<span class="token comment">;; a stack overflow error. This is a only a demonstration of clojure's multimethod</span>

<span class="token comment">;; identity form returns the same value passed</span>
<span class="token punctuation">(</span><span class="token keyword">defmulti</span> factorial identity<span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defmethod</span> factorial <span class="token number">0</span> <span class="token punctuation">[</span>_<span class="token punctuation">]</span>  <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">defmethod</span> factorial <span class="token symbol">:default</span> <span class="token punctuation">[</span>num<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">*</span> num <span class="token punctuation">(</span><span class="token function">factorial</span> <span class="token punctuation">(</span><span class="token keyword">dec</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token function">factorial</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">; => 1</span>
<span class="token punctuation">(</span><span class="token function">factorial</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">; => 1</span>
<span class="token punctuation">(</span><span class="token function">factorial</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">; => 6</span>
<span class="token punctuation">(</span><span class="token function">factorial</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">; => 5040</span>
</code></pre>
<h2 id="using-corematch">Using <code>core.match</code></h2>
<pre><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> div3? <span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">zero?</span> <span class="token punctuation">(</span><span class="token keyword">rem</span> x <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>y <span class="token punctuation">[</span><span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token function">match</span> <span class="token punctuation">[</span>y<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>_ <span class="token punctuation">(</span><span class="token function">a</span> <span class="token symbol">:guard</span> even?<span class="token punctuation">)</span> _ _<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token symbol">:a0</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>_ <span class="token punctuation">(</span><span class="token function">b</span> <span class="token symbol">:guard</span> <span class="token punctuation">[</span>odd? div3?<span class="token punctuation">]</span><span class="token punctuation">)</span> _ _<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token symbol">:a1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>x <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token function">match</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token punctuation">(</span><span class="token symbol">:or</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token symbol">:a0</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token punctuation">(</span><span class="token symbol">:or</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token symbol">:a1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">;=> :a1</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>x <span class="token punctuation">{</span><span class="token symbol">:a</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token function">match</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token symbol">:a</span> <span class="token punctuation">(</span><span class="token symbol">:or</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token symbol">:a0</span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token symbol">:a</span> <span class="token punctuation">(</span><span class="token symbol">:or</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token symbol">:a1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">;=> :a1</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>v <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token function">match</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token symbol">:a0</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span> a<span class="token punctuation">]</span> <span class="token symbol">:as</span> b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token symbol">:a1</span> a b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">;=> [:a1 2 [1 2]]</span>
</code></pre>
</div>
</article></main>

    

    <script src="/blog2-ssr/lazyLoadImages.js"></script></body>
</html>